<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Tienda de Plantas - Productos</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <nav class="nav">
      <div class="brand">TiendaVerde</div>
      <div class="menu">
        <a data-nav href="index.html">Inicio</a>
        <a data-nav href="productos.html">Productos</a>
        <a data-nav href="login.html">Login</a>
        <span>ðŸ›’<span class="badge" id="cart-count">0</span></span>
      </div>
    </nav>
  </header>

  <main>
    <div class="split">
      <section>
        <h2>Productos</h2>
        <div id="product-grid" class="grid"></div>
      </section>

      <aside class="card cart">
        <h3>Carrito</h3>
        <div id="cart-items"></div>
        <div id="cart-empty" class="cart-empty">Tu carrito estÃ¡ vacÃ­o.</div>
        <div class="cart-footer">
          <span>Total</span>
          <span id="cart-total">$0</span>
        </div>
        <button id="clear-cart" class="btn" style="margin-top:8px;">Vaciar carrito</button>
      </aside>
    </div>
  </main>

  <footer>
    Â© 2025 TiendaVerde (demo educativa).
  </footer>
  <script src="js/app.js"></script>
  <script src="js/productos.js"></script>




<!-- React + ReactDOM (UMD) y Babel para poder usar JSX en esta demo) -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel" data-presets="env,react">
  const { useState, useMemo } = React;

  // Tarjeta de producto con "cantidad" (demuestra estado local de React)
  const ProductCard = ({ product, onAdd }) => {
    const [qty, setQty] = useState(1);
    const q = Math.max(1, Number.isFinite(+qty) ? parseInt(qty) : 1);

    return (
      <div className={`card product-card ${product.variant === 'compact' ? 'compact' : ''}`}>
        {product.ribbon && <div className="ribbon">{product.ribbon}</div>}
        <img src={product.img} alt={product.name} loading="lazy" />
        <h4>{product.name}</h4>
        <div className="price">{CLP.format(product.price)}</div>

        <div className="qty">
          <input
            type="number"
            min="1"
            value={qty}
            onChange={e => setQty(e.target.value)}
            aria-label="Cantidad"
          />
          <button className="btn" onClick={() => onAdd(product.id, q)}>
            Agregar
          </button>
        </div>
      </div>
    );
  };

  // Barra de controles: buscar, categorÃ­a, ordenar, vista
  const Toolbar = ({ search, setSearch, category, setCategory, sort, setSort, layout, setLayout, categories, total }) => (
    <div className="toolbar card">
      <input
        placeholder="Buscar producto..."
        value={search}
        onChange={e => setSearch(e.target.value)}
      />
      <select value={category} onChange={e => setCategory(e.target.value)}>
        <option value="Todas">Todas las categorÃ­as</option>
        {categories.map(c => <option key={c} value={c}>{c}</option>)}
      </select>
      <select value={sort} onChange={e => setSort(e.target.value)}>
        <option value="name-asc">Nombre (Aâ†’Z)</option>
        <option value="price-asc">Precio (â†‘)</option>
        <option value="price-desc">Precio (â†“)</option>
      </select>
      <span className="spacer"></span>
      <button onClick={() => setLayout(layout === 'grid' ? 'list' : 'grid')}>
        {layout === 'grid' ? 'Vista lista' : 'Vista grid'}
      </button>
      <span className="small">Resultados: {total}</span>
    </div>
  );

  // App de productos: maneja estado y renderizado derivado (valor de React)
  const ProductsApp = ({ products }) => {
    const [search, setSearch] = useState('');
    const [category, setCategory] = useState('Todas');
    const [sort, setSort] = useState('name-asc');
    const [layout, setLayout] = useState('grid');

    const categories = useMemo(
      () => Array.from(new Set(products.map(p => p.category))).sort(),
      [products]
    );

    const filtered = useMemo(() => {
      let list = products;

      if (search.trim()) {
        const q = search.toLowerCase();
        list = list.filter(p => p.name.toLowerCase().includes(q));
      }
      if (category !== 'Todas') {
        list = list.filter(p => p.category === category);
      }

      switch (sort) {
        case 'price-asc':  list = [...list].sort((a,b) => a.price - b.price); break;
        case 'price-desc': list = [...list].sort((a,b) => b.price - a.price); break;
        default:           list = [...list].sort((a,b) => a.name.localeCompare(b.name));
      }
      return list;
    }, [products, search, category, sort]);

    const handleAdd = (id, qty) => {
      addToCart(id, qty);  // Reutilizamos tu lÃ³gica con cantidad
    };

    // Contenedor propio con clase grid o list (no dependemos del div original)
    return (
      <>
        <Toolbar
          search={search} setSearch={setSearch}
          category={category} setCategory={setCategory}
          sort={sort} setSort={setSort}
          layout={layout} setLayout={setLayout}
          categories={categories}
          total={filtered.length}
        />
        <div className={`grid ${layout === 'list' ? 'list' : ''}`}>
          {filtered.map(p => (
            <ProductCard key={p.id} product={p} onAdd={handleAdd} />
          ))}
        </div>
      </>
    );
  };

  // === Montaje React ===
  const mountNode = document.getElementById('product-grid');
  if (!mountNode) {
    console.error('No se encontrÃ³ #product-grid');
  } else if (typeof PRODUCTS === 'undefined') {
    console.error('PRODUCTS no estÃ¡ definido; revisa js/productos.js');
  } else {
    const root = ReactDOM.createRoot(mountNode);
    root.render(<ProductsApp products={PRODUCTS} />);
  }
</script>



</body>
</html>
